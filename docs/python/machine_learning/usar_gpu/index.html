<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Usar GPU para utilizar el machine learning">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="Uso GPU" />
<meta property="og:description" content="Usar GPU para utilizar el machine learning" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://irodrigob.github.io/docs/python/machine_learning/usar_gpu/" />
<meta property="article:modified_time" content="2020-08-05T18:49:01+02:00" />
<title>Uso GPU | Navi-developer</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e40449dffab36960ca7d6bac529d52d7ab9f9d230ffe5de1799e29cb61bc0cb7.css" integrity="sha256-5ARJ3/qzaWDKfWusUp1S16ufnSMP/l3heZ4py2G8DLc=">
<script defer src="/en.search.min.fd62f30cdd2a2ef6f58e20d8d1b2f30cf97ded917bb46866a46d2684e1e34cda.js" integrity="sha256-/WLzDN0qLvb1jiDY0bLzDPl97ZF7tGhmpG0mhOHjTNo="></script>

<script defer src="/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js" integrity="sha256-dKi7B/C&#43;6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>Navi-developer</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/github/" class="collapsed ">Github</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/hugo/" class="">Hugo</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/hugo/publicar_web_github/" class="">Publicar Web Github</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/" class="collapsed ">Python</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/python/enlaces_interes/" class="">Enlaces de interes</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/entorno_desarrollo/" class="">Entorno de desarrollo</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/extensiones/" class="">Extensiones</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/framework/" class="collapsed ">Frameworks</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/anaconda/" class="">Anaconda</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/configuracion_pylint/" class="">Configuración Pylint</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/" class="collapsed ">Machine learning</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/librerias/" class="">Librerias y paquetes</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/algoritmo_aprendizaje_no_supervisado/" class="collapsed ">Algoritmos de aprendizaje no supervisado</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/arbol_decisiones/" class="collapsed ">Arbol de decisiones</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/estimador_incertidumbre/" class="collapsed ">Estimador incertidumbre</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/guardar_modelos_entrenados/" class="">Guardar modelos entrenados</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/procesamiento_datos/" class="collapsed ">Procesamiento de datos</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/redes_neuronales/" class="collapsed ">Redes neuronales</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/regresion_lineal/" class="collapsed ">Regresion lineal</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/set_datos_propios/" class="collapsed ">Set de datos propios</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/tensorflow/" class="collapsed ">Tensor Flow</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/usar_gpu/" class="active">Uso GPU</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/machine_learning/vectorizacion/" class="collapsed ">Vectorización</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/sentencias/" class="collapsed ">Sentencias</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/react/" class="collapsed ">React</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/" class="">SAP</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/sap/abap/" class="collapsed ">ABAP</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/BW/" class="collapsed ">BW</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/gateway/" class="collapsed ">Gateway</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/ui5/" class="collapsed ">UI5</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/ventas/" class="collapsed ">Ventas</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
  </ul>
  











  
<ul>
  
  <li>
    <a href="https://github.com/irodrigob" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Uso GPU</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#introducción">Introducción</a></li>
    <li><a href="#tensor-flow">Tensor Flow</a>
      <ul>
        <li><a href="#instalar-cuda">Instalar CUDA</a></li>
        <li><a href="#instalar-cudnn">Instalar CUDnn</a></li>
        <li><a href="#creación-entorno-en-anaconda">Creación entorno en Anaconda</a></li>
        <li><a href="#solución-al-error-could-not-create-cudnn-handle-cudnn_status_internal_error">Solución al error <em>Could not create cudnn handle: CUDNN_STATUS_INTERNAL_ERROR</em></a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="introducción">
  Introducción
  <a class="anchor" href="#introducci%c3%b3n">#</a>
</h1>
<p>El objetivo es explicar que he hecho para poder hacer utilizar la GPUs de la tarjeta gráfica para las operaciones del machine learning. El motivo, es que una tarjeta gráfica tiene muchos más cpus que se pueden usar paralelamente para los calculos.</p>
<p>Se va explicar como se ha usado para TensorFlow pero puede servir para otras librerías.</p>
<p><strong>NOTA IMPORTANTE: El sistema operativo es Windows</strong></p>
<h1 id="tensor-flow">
  Tensor Flow
  <a class="anchor" href="#tensor-flow">#</a>
</h1>
<p>Lo primero que hay que hacer es mirar la 
  <a href="https://www.tensorflow.org/install/gpu">documentación oficial</a> para averiguar que versión de librerías es necesaria.</p>
<p>En el momento que se hace esta página Tensor Flow es compatible con CUDA 10.1. Por lo tanto hay que seguir los siguientes pasos:</p>
<h2 id="instalar-cuda">
  Instalar CUDA
  <a class="anchor" href="#instalar-cuda">#</a>
</h2>
<p>Descargar e instalar la versión de 
  <a href="https://developer.nvidia.com/cuda-toolkit-archive">CUDA</a> que sea compatible con TensorFlow. En la instalación solo he indicado que instale las librerías <em>runtime</em>. La integración con Visual Studio, ejemplos, etc.. no lo he seleccionado.</p>
<p>Una vez instalado hay que añadir el path donde se ha instalado a la variable de entorno <em>PATH</em> del sistema. Aunque cuando se entre al ver las variables de entorno aparece el <em>CUDA_PATH</em> pero no funciona. Hay que añadir la misma ruta que esta en esa variable en la <em>PATH</em>. Y luego reiniciar el sistema.</p>
<h2 id="instalar-cudnn">
  Instalar CUDnn
  <a class="anchor" href="#instalar-cudnn">#</a>
</h2>
<p>Es la librería que usa TensorFlow para poder usar el CUDA de la tarjeta gráfica. En esta 
  <a href="https://developer.nvidia.com/rdp/cudnn-archive">página</a> hay que descargar la versión asociada a la versión de CUDA. En la página ya lo indica.  Hay que tener en cuenta que hay que registrarse para podersela descargar.</p>
<p>Se descarga un fichero que hay que descomprimirlo donde uno quiera, pero luego hay que añadir la <em>ruta+\bin</em> en el variable de entorno <em>PATH</em>. Ejemplo yo lo tengo instalado en <em>K:\cuda</em>. Y la variable de entorno he puesto <em>K:\cuda\bin</em>. Un vez hecho hay que reiniciar el pc.</p>
<h2 id="creación-entorno-en-anaconda">
  Creación entorno en Anaconda
  <a class="anchor" href="#creaci%c3%b3n-entorno-en-anaconda">#</a>
</h2>
<p>En anaconda he creado un entorno nuevo llamado <em>tensorflow_gpu</em> donde la versión escogida de Python es la 3.8. Una vez creado he ido al <em>Anaconda PowerShell</em> para poder instalar los paquetes a través de <em>PiP</em> que es el instalador de paquetes de Python. El motivo de hacerlo de esta manera es que a través de anaconda he tenido muchos conflictos con las versiones de Python y librerias. Y mirando por internet he visto que esta solución me funciona ya que me instala paquetes más recientes que los que haría con Anaconda.</p>
<p>Dentro del powershel de Anaconda he hecho lo siguiente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">conda activate tensorflow-gpu
pip install tensorflow
pip install tensorflow-gpu
</code></pre></div><p>Estas dos librerías instalarán todas las librerías que necesiten.</p>
<p>Aunque se instale con <em>PiP</em> en Anaconda veremos lo que se ha instalado:</p>
<p>
  <img src="/images/python/machine_learning/anaconda/paquetes_usando_pip.png" alt="Tensor Flow" /></p>
<p>Para desintalar habría que hacer:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">pip uninstall tensorflow
pip uninstall tensorflow-gpu
pip uninstall protobuf
</code></pre></div><h2 id="solución-al-error-could-not-create-cudnn-handle-cudnn_status_internal_error">
  Solución al error <em>Could not create cudnn handle: CUDNN_STATUS_INTERNAL_ERROR</em>
  <a class="anchor" href="#soluci%c3%b3n-al-error-could-not-create-cudnn-handle-cudnn_status_internal_error">#</a>
</h2>
<p>Este error aparece por un problema de memoria de las CPUs de NVIDIA. Para solucionar hay que poner las siguiente líneas después del <em>import</em> de la librería de TensorFlow y antes del código principal:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">physical_devices = tf.config.experimental.list_physical_devices(&#39;GPU&#39;)
assert len(physical_devices) &gt; 0, &#34;Not enough GPU hardware devices available&#34;
config = tf.config.experimental.set_memory_growth(physical_devices[0], True)
</code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#introducción">Introducción</a></li>
    <li><a href="#tensor-flow">Tensor Flow</a>
      <ul>
        <li><a href="#instalar-cuda">Instalar CUDA</a></li>
        <li><a href="#instalar-cudnn">Instalar CUDnn</a></li>
        <li><a href="#creación-entorno-en-anaconda">Creación entorno en Anaconda</a></li>
        <li><a href="#solución-al-error-could-not-create-cudnn-handle-cudnn_status_internal_error">Solución al error <em>Could not create cudnn handle: CUDNN_STATUS_INTERNAL_ERROR</em></a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












