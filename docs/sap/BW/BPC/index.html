<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Información general de BPC">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="BPC" />
<meta property="og:description" content="Información general de BPC" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://irodrigob.github.io/docs/sap/BW/BPC/" />
<meta property="article:modified_time" content="2022-07-25T16:01:52+02:00" />
<title>BPC | Navi-developer</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.e40449dffab36960ca7d6bac529d52d7ab9f9d230ffe5de1799e29cb61bc0cb7.css" integrity="sha256-5ARJ3/qzaWDKfWusUp1S16ufnSMP/l3heZ4py2G8DLc=">
<script defer src="/en.search.min.852a8e8639e16f893b851518fcc272ee732886df15585cfeeb96570a72b8afdd.js" integrity="sha256-hSqOhjnhb4k7hRUY/MJy7nMoht8VWFz&#43;65ZXCnK4r90="></script>

<script defer src="/sw.min.74a8bb07f0bee86d6bb9a2750f073f14d93c7e4512f28860370cfd879e9719b4.js" integrity="sha256-dKi7B/C&#43;6G1ruaJ1Dwc/FNk8fkUS8ohgNwz9h56XGbQ="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body dir=>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>Navi-developer</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  



  
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/github/" class="collapsed ">Github</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/graph_ql/" class="collapsed ">GraphQL</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/hugo/" class="">Hugo</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/hugo/publicar_web_github/" class="">Publicar Web Github</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/mongodb/" class="">MongoDB</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/mongodb/usando_app/" class="">MongoDB en aplicaciones</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/mongodb/usando_app/mongoose/" class="">Conector Mongoose</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/mongodb/cloud/" class="collapsed ">MongoDB en cloud</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/python/" class="collapsed ">Python</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/react/" class="collapsed ">React</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/" class="">SAP</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/sap/abap/" class="collapsed ">ABAP</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/BW/" class="collapsed ">BW</a>
  

          
  
  
  

  
  <ul>
    
      
        <li>
          
  
    <a href="/docs/sap/BW/BPC/" class="active">BPC</a>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/BW/informacion_general/" class="">Información general</a>
  

        </li>
      
    
  </ul>
  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/gateway/" class="collapsed ">Gateway</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/ui5/" class="collapsed ">UI5</a>
  

          
  
  
  

  

        </li>
      
    
      
        <li>
          
  
    <a href="/docs/sap/ventas/" class="collapsed ">Ventas</a>
  

          
  
  
  

  

        </li>
      
    
  </ul>
  

        </li>
      
    
  </ul>
  











  
<ul>
  
  <li>
    <a href="https://github.com/irodrigob" target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>BPC</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#objetivo">Objetivo</a></li>
    <li><a href="#cambiar-variables-de-secuencias-de-planificación-en-bpc">Cambiar variables de secuencias de planificación en BPC</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="objetivo">
  Objetivo
  <a class="anchor" href="#objetivo">#</a>
</h1>
<p>Como hago poco de BPC agruparé en esta página lo que haga de dicho módulo.</p>
<h1 id="cambiar-variables-de-secuencias-de-planificación-en-bpc">
  Cambiar variables de secuencias de planificación en BPC
  <a class="anchor" href="#cambiar-variables-de-secuencias-de-planificaci%c3%b3n-en-bpc">#</a>
</h1>
<p>En este programa cambia los valores de variables para secuencias de planificación.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tpl" data-lang="tpl">*&amp;---------------------------------------------------------------------*
*&amp; Report ZRTC_CUSTOM_PROCESS
*&amp;---------------------------------------------------------------------*
*&amp;
*&amp;---------------------------------------------------------------------*
REPORT zrtc_custom_process.

TABLES: /bi0/pfiscper.

CONSTANTS cv_period_variable TYPE rsr_s_var_id VALUE &#39;ZVAR_RTC_PF_PERIOD&#39;.

TYPES: BEGIN OF ts_result_data,
         seqnam       TYPE rspls_seqnm,
         variant      TYPE rsr_s_para_catalog-paramnm,
         variant_desc TYPE rsr_s_para_catalog-txtlg,
         msg_type     TYPE bapiret2-type,
         message      TYPE bapiret2-message,
       END OF ts_result_data.
TYPES: tt_result_data TYPE STANDARD TABLE OF ts_result_data WITH DEFAULT KEY.

DATA: mt_result_data TYPE tt_result_data.
DATA mv_variant TYPE rsplfrparamnm.
DATA mv_variant_desc TYPE rsr_s_para_catalog-txtlg.


************************************************************************
*SELECTION-SCREEN
************************************************************************
SELECTION-SCREEN BEGIN OF BLOCK b1 WITH FRAME TITLE TEXT-t01.
  SELECT-OPTIONS s_period FOR  /bi0/pfiscper-fiscper OBLIGATORY.
SELECTION-SCREEN END OF BLOCK b1.

SELECTION-SCREEN BEGIN OF BLOCK b2 WITH FRAME TITLE TEXT-t02.
  PARAMETERS : p_prev AS CHECKBOX DEFAULT &#39;&#39; .
  PARAMETERS : p_nsap AS CHECKBOX DEFAULT &#39;&#39; .
  PARAMETERS : p_bcf AS CHECKBOX DEFAULT &#39;&#39; .
  PARAMETERS : p_appr AS CHECKBOX DEFAULT &#39;&#39; .
SELECTION-SCREEN END OF BLOCK b2.


START-OF-SELECTION.
  CLEAR: mt_result_data.

  IF p_prev EQ abap_true.

    DATA(lv_error_prev) = abap_false.

    PERFORM save_values_variant USING &#39;ZPS_RTC_STEP_1&#39; CHANGING lv_error_prev mv_variant mv_variant_desc.
    IF lv_error_prev = abap_false.
      PERFORM execute_plseq USING &#39;ZPS_RTC_STEP_1&#39; mv_variant mv_variant_desc.
    ENDIF.
  ENDIF.


  IF p_nsap EQ abap_true.

    DATA(lv_error_nsap) = abap_false.

    PERFORM save_values_variant USING &#39;ZPS_RTC_ACTUAL_NOSAP&#39; CHANGING lv_error_nsap mv_variant mv_variant_desc.
    IF lv_error_nsap = abap_false.
      PERFORM execute_plseq USING &#39;ZPS_RTC_STEP_1&#39; mv_variant mv_variant_desc.
    ENDIF.

  ENDIF.


  IF p_bcf EQ abap_true.

    DATA(lv_error_bcf) = abap_false.

    PERFORM save_values_variant USING &#39;ZPS_RTC_ACTUAL_NOSAP&#39; CHANGING lv_error_bcf mv_variant mv_variant_desc.
    IF lv_error_bcf = abap_false.
      PERFORM execute_plseq USING &#39;ZPS_RTC_STEP_1&#39; mv_variant mv_variant_desc.
    ENDIF.

  ENDIF.


  IF p_appr EQ abap_true.
    DATA(lv_error_appr) = abap_false.

    PERFORM save_values_variant USING &#39;ZPS_RTC_ACTUAL_NOSAP&#39; CHANGING lv_error_appr mv_variant mv_variant_desc.
    IF lv_error_appr = abap_false.
      PERFORM execute_plseq USING &#39;ZPS_RTC_STEP_1&#39; mv_variant mv_variant_desc.
    ENDIF.
  ENDIF.

END-OF-SELECTION.

  PERFORM show_alv.


FORM save_values_variant USING pe_seqnam TYPE rspls_seqnm
                         CHANGING ps_error TYPE sap_bool
                                  ps_variant TYPE rsplfrparamnm
                                  ps_variant_desc TYPE rsr_s_para_catalog-txtlg.

  DATA lv_handle TYPE rsr_handle .
  DATA lt_return2 TYPE bapiret2_t.
  DATA lt_values TYPE rsr_t_variable_values.
  DATA lt_variants TYPE rsr_t_para_catalog.

  CLEAR: ps_error, ps_variant, ps_variant_desc.

  &#34; Función que nos devuelve el handler de la secuencia de acceso
  CALL FUNCTION &#39;RSPLSSE_PLSEQ_SCREEN_NECESSARY&#39;
    EXPORTING
      i_seqnm      = pe_seqnam
      i_objvers    = &#39;A&#39;
    IMPORTING
      e_var_handle = lv_handle
    TABLES
      e_tk_return  = lt_return2[].

  IF NOT line_exists( lt_return2[ type = &#39;E&#39; ] ).

    CLEAR: lt_return2.

    &#34; Función que inicializa las variantes a partir del handler. Este paso es crítico ya que se
    &#34; inicializan tablas y clases internas que son necesarias para luego poder leer y grabar las variantes.
    CALL FUNCTION &#39;RSPLW_SEQ_VAR_INIT&#39;
      EXPORTING
        i_handle = lv_handle
      IMPORTING
        e_t_msg  = lt_return2.
    IF NOT line_exists( lt_return2[ type = &#39;E&#39; ] ).

      PERFORM get_variants USING lv_handle CHANGING lt_variants.
      LOOP AT lt_variants ASSIGNING FIELD-SYMBOL(&lt;ls_variants&gt;).
        CLEAR lt_values.

        &#34; Función que lee los valores de la variante
        CALL FUNCTION &#39;RSR_VAR_VARIANT_VALUE_SET&#39;
          EXPORTING
            i_var_cont_handle = lv_handle
            i_variant         = &lt;ls_variants&gt;-paramnm
          IMPORTING
            e_t_values        = lt_values.


        &#34; Localizamos la variable de periodo
        LOOP AT lt_values ASSIGNING FIELD-SYMBOL(&lt;ls_values&gt;) WHERE var_id CS cv_period_variable.
          EXIT.
        ENDLOOP.
        IF sy-subrc NE 0.
*            INSERT VALUE #( var_id  = VALUE rsr_s_var_id( handle = lv_handle vnam = pe_seqnam ) )
*                   INTO TABLE lt_values ASSIGNING &lt;ls_values&gt;.
        ELSE.
          ps_variant = &lt;ls_variants&gt;-paramnm.
          ps_variant_desc = &lt;ls_variants&gt;-txtlg.

          PERFORM fill_values USING &lt;ls_values&gt; .
          PERFORM save_values USING lv_handle &lt;ls_variants&gt; pe_seqnam  CHANGING lt_values.

          EXIT. &#34; Se sale porque ya la he encontrado

        ENDIF.

      ENDLOOP.
      &#34; Si no hay variante es que no se ha encontrado por lo tanto se devuelve un error
      IF ps_variant IS INITIAL.
        INSERT VALUE #( seqnam = pe_seqnam
               msg_type = &#39;E&#39;
               message = TEXT-e01 ) INTO TABLE mt_result_data.
      ENDIF.

    ELSE.
      PERFORM add_bapiret2_2_return_data USING pe_seqnam space space lt_return2.
    ENDIF.

  ELSE.
    PERFORM add_bapiret2_2_return_data USING pe_seqnam space space lt_return2.
  ENDIF.


  &#34; Devuelvo si hay un error en el proceso
  ps_error = COND #( WHEN line_exists( mt_result_data[ seqnam = pe_seqnam msg_type = &#39;E&#39; ] ) THEN abap_true ELSE abap_false ).


ENDFORM.

FORM add_bapiret2_2_return_data USING pe_seqnam pe_variant pe_variant_desc pe_return2 TYPE bapiret2_t.

  LOOP AT pe_return2 ASSIGNING FIELD-SYMBOL(&lt;ls_return2&gt;).

    INSERT VALUE #( seqnam = pe_seqnam
                    variant = pe_variant
                    variant_desc = pe_variant_desc
                    msg_type = &lt;ls_return2&gt;-type ) INTO TABLE mt_result_data ASSIGNING FIELD-SYMBOL(&lt;ls_data&gt;).

    MESSAGE ID &lt;ls_return2&gt;-id TYPE &lt;ls_return2&gt;-type NUMBER &lt;ls_return2&gt;-number
                INTO &lt;ls_data&gt;-message
                WITH &lt;ls_return2&gt;-message_v1 &lt;ls_return2&gt;-message_v2 &lt;ls_return2&gt;-message_v3 &lt;ls_return2&gt;-message_v4.

  ENDLOOP.

ENDFORM.

FORM execute_plseq USING pe_seqnam TYPE rspls_seqnm
                         pe_variant TYPE rsplfrparamnm
                         pe_variant_desc TYPE rsr_s_para_catalog-txtlg.

  DATA lt_return TYPE bapiret2_t.

  CALL FUNCTION &#39;RSPLSSE_PLSEQ_EXECUTE&#39;
    EXPORTING
      i_seqnm     = pe_seqnam
      i_variant   = pe_variant
*     I_FAST_ENQUEUE       = RS_C_FALSE
    TABLES
      e_tk_return = lt_return[].

  PERFORM add_bapiret2_2_return_data USING &#39;ZPS_RTC_STEP_1&#39; pe_variant pe_variant_desc lt_return.

  IF NOT line_exists( lt_return[ type = &#39;E&#39; ] ).
    CALL FUNCTION &#39;RSPLSTD_DATA_SAVE&#39;.
  ENDIF.
ENDFORM.

FORM show_alv.
  DATA lo_alv TYPE REF TO cl_salv_table.

  TRY.
      CALL METHOD cl_salv_table=&gt;factory
        IMPORTING
          r_salv_table = lo_alv
        CHANGING
          t_table      = mt_result_data.

      DATA(lo_columns) = lo_alv-&gt;get_columns(  ).
      lo_columns-&gt;set_optimize( abap_true ).

      DATA(lo_column) = lo_columns-&gt;get_column( &#39;VARIANT&#39; ).
      lo_column-&gt;set_fixed_header_text( CONV #( TEXT-c01 ) ).
      lo_column-&gt;set_medium_text( CONV #( TEXT-c01 ) ).
      lo_column-&gt;set_long_text( CONV #( TEXT-c01 ) ).
      lo_column = lo_columns-&gt;get_column( &#39;VARIANT_DESC&#39; ).
      lo_column-&gt;set_fixed_header_text( CONV #( TEXT-c02 ) ).
      lo_column-&gt;set_medium_text( CONV #( TEXT-c02 ) ).
      lo_column-&gt;set_long_text( CONV #( TEXT-c02 ) ).

      lo_alv-&gt;display( ).

    CATCH cx_salv_msg.
  ENDTRY.
ENDFORM.

FORM get_variants USING pe_handle TYPE rsr_handle
                  CHANGING ps_variants TYPE rsr_t_para_catalog.

  CLEAR: ps_variants.

  CALL FUNCTION &#39;RSR_VAR_VARIANT_LIST_GET&#39;
    EXPORTING
      i_var_cont_handle = pe_handle
    IMPORTING
      e_t_variant       = ps_variants.
ENDFORM.

FORM save_values USING pe_handle TYPE rsr_handle
                       pe_variant TYPE rsr_s_para_catalog
                       pe_seqnam TYPE rspls_seqnm
                 CHANGING ps_values TYPE rsr_t_variable_values.

  DATA lt_return TYPE bapiret2_t.


  &#34; Pasamos los valores actualizados
  CALL FUNCTION &#39;RSR_VAR_SET_VALUES&#39;
    EXPORTING
      i_var_cont_handle = pe_handle
      i_t_values        = ps_values
    IMPORTING
      e_t_return        = lt_return.

  IF NOT line_exists( lt_return[ type = &#39;E&#39; ] ).
    CLEAR: lt_return.

    &#34; Finalmente se graban los valores
    DATA(lv_variant_string) = |<span style="color:#75715e">{</span> <span style="color:#a6e22e">pe_variant</span><span style="color:#f92672">-</span><span style="color:#a6e22e">paramnm</span> <span style="color:#75715e">}</span>|.
    CALL FUNCTION &#39;RSR_VAR_VARIANT_CHANGE&#39;
      EXPORTING
        i_var_cont_handle = pe_handle
        i_variant_id      = lv_variant_string
      IMPORTING
        e_t_return        = lt_return.

    IF NOT line_exists( lt_return[ type = &#39;E&#39; ] ).
      INSERT VALUE #( seqnam = pe_seqnam
             variant = pe_variant-paramnm
             variant_desc = pe_variant-txtlg
             msg_type = &#39;S&#39;
             message = TEXT-s01 ) INTO TABLE mt_result_data.
    ELSE.
      PERFORM add_bapiret2_2_return_data USING pe_seqnam pe_variant-paramnm pe_variant-txtlg lt_return.
    ENDIF.
  ENDIF.
ENDFORM.

FORM fill_values CHANGING ps_value TYPE rsr_s_variable_values .
  CLEAR ps_value-values.

  &#34; Se pasan los periodos a los valores.
  LOOP AT s_period ASSIGNING FIELD-SYMBOL(&lt;s_period&gt;).
    &#34; Todos los campos que se informan son necesarios.
    INSERT VALUE #( sign = &lt;s_period&gt;-sign
                   opt = &lt;s_period&gt;-option
                   low = &lt;s_period&gt;-low
                   high = &lt;s_period&gt;-high
                   lowtxt_len = 20
                   lowtxt_tp = &#39;S&#39; ) INTO TABLE ps_value-values ASSIGNING FIELD-SYMBOL(&lt;ls_value_ranges&gt;).

    &#34; Este campo tiene el formato externo del periodo, sino se rellena, se graba un # como valor. Da igual si viene en el
    &#34; campo low informado.
    &lt;ls_value_ranges&gt;-low_ext = |<span style="color:#75715e">{</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">ls_value_ranges</span><span style="color:#f92672">&gt;-</span><span style="color:#a6e22e">low</span><span style="color:#f92672">+</span><span style="color:#ae81ff">4</span><span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">)</span> <span style="color:#75715e">}</span>.<span style="color:#75715e">{</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">ls_value_ranges</span><span style="color:#f92672">&gt;-</span><span style="color:#a6e22e">low</span><span style="color:#f92672">(</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span> <span style="color:#75715e">}</span>|.

    &#34; En el caso de tener un rango lo informo. El IS INITIAL no me chuta con lo cual he ido a la antigua usanza.
    IF &lt;ls_value_ranges&gt;-high NE &#39;0000000&#39;.
      &lt;ls_value_ranges&gt;-high_ext = |<span style="color:#75715e">{</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">ls_value_ranges</span><span style="color:#f92672">&gt;-</span><span style="color:#a6e22e">high</span><span style="color:#f92672">+</span><span style="color:#ae81ff">4</span><span style="color:#f92672">(</span><span style="color:#ae81ff">3</span><span style="color:#f92672">)</span> <span style="color:#75715e">}</span>.<span style="color:#75715e">{</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">ls_value_ranges</span><span style="color:#f92672">&gt;-</span><span style="color:#a6e22e">high</span><span style="color:#f92672">(</span><span style="color:#ae81ff">4</span><span style="color:#f92672">)</span> <span style="color:#75715e">}</span>|.
      &lt;ls_value_ranges&gt;-hightxt_len = 20.
      &lt;ls_value_ranges&gt;-hightxt_tp = &#39;S&#39;.
    ENDIF.
  ENDLOOP.
ENDFORM.
</code></pre></div></article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>

 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#objetivo">Objetivo</a></li>
    <li><a href="#cambiar-variables-de-secuencias-de-planificación-en-bpc">Cambiar variables de secuencias de planificación en BPC</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












